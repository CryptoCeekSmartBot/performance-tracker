<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Tracker Pro | Corporate Analytics Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    .light-mode::-webkit-scrollbar-track { background: #e2e8f0; }
    .light-mode::-webkit-scrollbar-thumb { background: #94a3b8; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    .animate-pulse-slow { animation: pulse 2s ease-in-out infinite; }
    .gradient-text { background: linear-gradient(135deg, #06b6d4, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .cell-green { background: linear-gradient(135deg, #059669, #10b981); }
    .cell-yellow { background: linear-gradient(135deg, #d97706, #f59e0b); }
    .cell-red { background: linear-gradient(135deg, #dc2626, #ef4444); }
    .glass { backdrop-filter: blur(10px); }
    @media print {
      .no-print { display: none !important; }
      body { background: white !important; }
    }
  </style>
</head>
<body class="bg-slate-950 text-gray-100 min-h-screen">
  <div id="app">
    <!-- Loading State -->
    <div id="upload-screen" class="min-h-screen flex items-center justify-center p-4">
      <div class="max-w-2xl w-full animate-fade-in">
        <div class="text-center mb-8">
          <h1 class="text-4xl md:text-5xl font-bold gradient-text mb-3">Performance Tracker Pro</h1>
          <p class="text-gray-400 text-lg">Corporate Employee Performance Analytics</p>
        </div>
        
        <div id="drop-zone" class="bg-slate-900 border-2 border-dashed border-slate-700 rounded-2xl p-12 md:p-16 text-center cursor-pointer transition-all duration-300 hover:border-cyan-500 hover:bg-cyan-500/5">
          <div class="mb-6">
            <div class="w-20 h-20 mx-auto rounded-2xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center mb-4 shadow-lg shadow-cyan-500/25">
              <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-white mb-2">Drop Excel File Here</h3>
            <p class="text-gray-400">or click to browse</p>
          </div>
          
          <input type="file" id="file-input" accept=".xls,.xlsx" class="hidden">
          
          <div class="flex items-center justify-center gap-2 text-gray-500 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            Supports .xls and .xlsx files
          </div>
        </div>
        
        <div class="mt-8 grid grid-cols-3 gap-4 text-center">
          <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
            <div class="text-2xl mb-2">üìä</div>
            <div class="text-sm text-gray-400">Real-time Analytics</div>
          </div>
          <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
            <div class="text-2xl mb-2">üéØ</div>
            <div class="text-sm text-gray-400">Target Tracking</div>
          </div>
          <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
            <div class="text-2xl mb-2">üèÜ</div>
            <div class="text-sm text-gray-400">Leaderboards</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard (Hidden Initially) -->
    <div id="dashboard" class="hidden">
      <!-- Header -->
      <header class="bg-slate-900/95 border-b border-slate-800 sticky top-0 z-40 glass no-print">
        <div class="max-w-[1920px] mx-auto px-4 py-3">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div class="flex items-center gap-4">
              <h1 class="text-xl font-bold gradient-text">Performance Tracker Pro</h1>
              <span id="report-date-badge" class="px-3 py-1 rounded-full text-xs font-medium bg-slate-800 text-gray-300"></span>
            </div>
            
            <div class="flex flex-wrap items-center gap-3">
              <div class="relative">
                <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <input type="text" id="search-input" placeholder="Search employee..." class="bg-slate-800 border border-slate-700 text-gray-100 pl-10 pr-4 py-2 rounded-lg text-sm w-48 focus:outline-none focus:ring-2 focus:ring-cyan-500">
              </div>
              
              <select id="filter-select" class="bg-slate-800 border border-slate-700 text-gray-100 px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                <option value="all">All Status</option>
                <option value="ontrack">‚úÖ On Track</option>
                <option value="atrisk">‚ö†Ô∏è At Risk</option>
                <option value="critical">üî¥ Critical</option>
                <option value="star">‚≠ê Stars</option>
              </select>
              
              <button id="theme-toggle" class="p-2 rounded-lg hover:bg-slate-800 border border-slate-700" title="Toggle theme">‚òÄÔ∏è</button>
              <button id="fullscreen-toggle" class="p-2 rounded-lg hover:bg-slate-800 border border-slate-700" title="Fullscreen">‚õ∂</button>
              <button id="print-btn" class="p-2 rounded-lg hover:bg-slate-800 border border-slate-700" title="Print">üñ®Ô∏è</button>
              <button id="new-upload-btn" class="p-2 rounded-lg hover:bg-slate-800 border border-slate-700" title="New Upload">üì§</button>
            </div>
          </div>
        </div>
      </header>

      <main class="max-w-[1920px] mx-auto p-4 space-y-6">
        <!-- Summary Cards -->
        <div id="summary-cards" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>

        <!-- Champion & Leaderboard -->
        <div class="grid lg:grid-cols-3 gap-4">
          <div id="champion-card" class="bg-gradient-to-br from-amber-900/30 to-yellow-900/20 border border-slate-800 rounded-xl p-6"></div>
          <div id="leaderboard-card" class="bg-slate-900 border border-slate-800 rounded-xl p-4 lg:col-span-2"></div>
        </div>

        <!-- Color Legend -->
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="flex flex-wrap items-center gap-6 justify-center text-sm">
            <div class="flex items-center gap-2">
              <span class="font-semibold">Target 8:</span>
              <div class="flex items-center gap-1"><div class="w-4 h-4 rounded cell-green"></div><span class="text-xs">‚â•8</span></div>
              <div class="flex items-center gap-1"><div class="w-4 h-4 rounded cell-yellow"></div><span class="text-xs">6-7</span></div>
              <div class="flex items-center gap-1"><div class="w-4 h-4 rounded cell-red"></div><span class="text-xs">&lt;6</span></div>
            </div>
            <div class="w-px h-6 bg-slate-700"></div>
            <div class="flex items-center gap-2">
              <span class="font-semibold">Target 10:</span>
              <div class="flex items-center gap-1"><div class="w-4 h-4 rounded cell-green"></div><span class="text-xs">‚â•10</span></div>
              <div class="flex items-center gap-1"><div class="w-4 h-4 rounded cell-yellow"></div><span class="text-xs">8-9</span></div>
              <div class="flex items-center gap-1"><div class="w-4 h-4 rounded cell-red"></div><span class="text-xs">&lt;8</span></div>
            </div>
            <div class="w-px h-6 bg-slate-700"></div>
            <div class="flex items-center gap-3 text-xs text-gray-400">
              <span class="text-emerald-400">‚Üë Improving</span>
              <span>‚Üí Stable</span>
              <span class="text-red-400">‚Üì Declining</span>
            </div>
          </div>
        </div>

        <!-- Main Table -->
        <div class="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
          <div class="overflow-x-auto">
            <table id="main-table" class="w-full text-sm">
              <thead id="table-header" class="bg-slate-800 sticky top-0"></thead>
              <tbody id="table-body"></tbody>
            </table>
          </div>
        </div>

        <!-- Footer Stats -->
        <div id="footer-stats" class="grid md:grid-cols-3 gap-4"></div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-sm py-4">
          Performance Tracker Pro ‚Ä¢ Corporate Analytics Dashboard
        </div>
      </main>
    </div>
  </div>

  <script>
    // Global state
    let appData = null;
    let darkMode = true;
    let searchTerm = '';
    let filterStatus = 'all';
    let sortConfig = { key: null, direction: 'asc' };

    // DOM Elements
    const uploadScreen = document.getElementById('upload-screen');
    const dashboard = document.getElementById('dashboard');
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const searchInput = document.getElementById('search-input');
    const filterSelect = document.getElementById('filter-select');

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      setupEventListeners();
    });

    function setupEventListeners() {
      // File upload
      dropZone.addEventListener('click', () => fileInput.click());
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('border-cyan-500', 'bg-cyan-500/10');
      });
      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('border-cyan-500', 'bg-cyan-500/10');
      });
      dropZone.addEventListener('drop', handleDrop);
      fileInput.addEventListener('change', handleFileSelect);

      // Controls
      searchInput.addEventListener('input', (e) => {
        searchTerm = e.target.value;
        renderTable();
      });
      filterSelect.addEventListener('change', (e) => {
        filterStatus = e.target.value;
        renderTable();
      });
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
      document.getElementById('fullscreen-toggle').addEventListener('click', toggleFullscreen);
      document.getElementById('print-btn').addEventListener('click', () => window.print());
      document.getElementById('new-upload-btn').addEventListener('click', resetApp);
    }

    function handleDrop(e) {
      e.preventDefault();
      dropZone.classList.remove('border-cyan-500', 'bg-cyan-500/10');
      const file = e.dataTransfer.files[0];
      if (file && (file.name.endsWith('.xls') || file.name.endsWith('.xlsx'))) {
        parseExcel(file);
      } else {
        alert('Please upload a valid Excel file (.xls or .xlsx)');
      }
    }

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file) parseExcel(file);
    }

    function parseExcel(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const workbook = XLSX.read(e.target.result, { type: 'array' });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          processData(jsonData);
        } catch (error) {
          alert('Error parsing Excel file. Please check the format.');
          console.error(error);
        }
      };
      reader.readAsArrayBuffer(file);
    }

    function processData(jsonData) {
      // Extract report date
      const reportDateStr = jsonData[0]?.[0] || '';
      const dateMatch = reportDateStr.match(/(\d{2})\/(\d{2})\/(\d{4})/);
      const currentDay = dateMatch ? parseInt(dateMatch[1]) : 13;
      const currentMonth = dateMatch ? dateMatch[2] : '01';
      const currentYear = dateMatch ? dateMatch[3] : '2026';

      // Parse employees
      const employees = [];
      for (let i = 4; i < jsonData.length - 2; i++) {
        const row = jsonData[i];
        if (!row || !row[1]) continue;

        const decoName = row[1]?.toString() || '';
        
        // Filter: Only PR### employees
        const prMatch = decoName.match(/\(PR\d+\)/);
        if (!prMatch) continue;

        const dailyTarget = parseInt(row[6]) || 8;
        const retailPending = parseInt(row[2]) || 0;
        const imagesDone = parseInt(row[3]) || 0;
        const prolinksPending = parseInt(row[4]) || 0;
        const svgPending = parseInt(row[5]) || 0;

        // Parse daily data
        const dailyData = [];
        let totalDone = 0;
        let totalRetail = 0, totalProlinks = 0, totalSvg = 0;

        for (let day = 1; day <= 31; day++) {
          const baseCol = 7 + (day - 1) * 3;
          const retail = parseInt(row[baseCol]) || 0;
          const prolinks = parseInt(row[baseCol + 1]) || 0;
          const svg = parseInt(row[baseCol + 2]) || 0;
          const total = retail + prolinks + svg;

          dailyData.push({ day, retail, prolinks, svg, total, isActive: day <= currentDay });

          if (day <= currentDay) {
            totalDone += total;
            totalRetail += retail;
            totalProlinks += prolinks;
            totalSvg += svg;
          }
        }

        // Metrics
        const workingDays = currentDay;
        const targetRequired = dailyTarget * workingDays;
        const shortfall = Math.max(0, targetRequired - totalDone);
        const achievementPct = targetRequired > 0 ? (totalDone / targetRequired * 100) : 0;

        // Trend
        const last5Days = dailyData.filter(d => d.isActive).slice(-5);
        const trend = calculateTrend(last5Days);

        // Alerts
        const alerts = calculateAlerts(dailyData, dailyTarget, currentDay, achievementPct);

        employees.push({
          name: decoName.replace(/\s*\(PR\d+\)/, '').trim(),
          id: prMatch[0],
          fullName: decoName,
          dailyTarget,
          dailyData,
          totalDone,
          totalRetail,
          totalProlinks,
          totalSvg,
          targetRequired,
          shortfall,
          achievementPct,
          retailPending,
          prolinksPending,
          svgPending,
          totalPending: retailPending + prolinksPending + svgPending,
          trend,
          alerts,
          imagesDone
        });
      }

      // Sort for leaderboard
      const sortedByAchievement = [...employees].sort((a, b) => b.achievementPct - a.achievementPct);

      appData = {
        employees,
        currentDay,
        currentMonth,
        currentYear,
        reportDate: `${currentDay}/${currentMonth}/${currentYear}`,
        leaderboard: sortedByAchievement.slice(0, 10),
        champion: sortedByAchievement[0],
        teamStats: calculateTeamStats(employees, currentDay)
      };

      showDashboard();
    }

    function calculateTrend(last5Days) {
      if (last5Days.length < 2) return 'stable';
      const recent = last5Days.slice(-2).reduce((a, b) => a + b.total, 0) / 2;
      const earlier = last5Days.slice(0, 2).reduce((a, b) => a + b.total, 0) / 2;
      const diff = recent - earlier;
      if (diff > 1) return 'up';
      if (diff < -1) return 'down';
      return 'stable';
    }

    function calculateAlerts(dailyData, target, currentDay, achievementPct) {
      const alerts = [];
      const activeDays = dailyData.filter(d => d.isActive);
      const last3 = activeDays.slice(-3);
      const threshold = target === 10 ? 8 : 6;

      if (last3.length === 3 && last3.every(d => d.total < threshold)) {
        alerts.push({ type: 'critical', message: '3+ days below target' });
      }
      if (achievementPct < 80 && currentDay > 5) {
        alerts.push({ type: 'warning', message: 'At risk of missing target' });
      }
      const today = activeDays[activeDays.length - 1];
      if (today && today.total === 0) {
        alerts.push({ type: 'inactive', message: 'No output today' });
      }
      if (achievementPct >= 110) {
        alerts.push({ type: 'star', message: 'Star performer' });
      }
      const last5 = activeDays.slice(-5);
      if (last5.length >= 5) {
        const firstHalf = last5.slice(0, 2).reduce((a, b) => a + b.total, 0);
        const secondHalf = last5.slice(-2).reduce((a, b) => a + b.total, 0);
        if (secondHalf > firstHalf + 2) {
          alerts.push({ type: 'improving', message: 'Improving trend' });
        }
      }
      return alerts;
    }

    function calculateTeamStats(employees, currentDay) {
      const total = employees.length;
      const avgAchievement = employees.reduce((a, b) => a + b.achievementPct, 0) / total;
      const onTrack = employees.filter(e => e.achievementPct >= 100).length;
      const atRisk = employees.filter(e => e.achievementPct >= 80 && e.achievementPct < 100).length;
      const critical = employees.filter(e => e.achievementPct < 80).length;
      const totalOutput = employees.reduce((a, b) => a + b.totalDone, 0);
      const totalTarget = employees.reduce((a, b) => a + b.targetRequired, 0);
      const totalRetail = employees.reduce((a, b) => a + b.totalRetail, 0);
      const totalProlinks = employees.reduce((a, b) => a + b.totalProlinks, 0);
      const totalSvg = employees.reduce((a, b) => a + b.totalSvg, 0);
      const totalRetailPending = employees.reduce((a, b) => a + b.retailPending, 0);
      const totalProlinksPending = employees.reduce((a, b) => a + b.prolinksPending, 0);
      const totalSvgPending = employees.reduce((a, b) => a + b.svgPending, 0);

      return { 
        total, avgAchievement, onTrack, atRisk, critical, totalOutput, totalTarget, currentDay,
        totalRetail, totalProlinks, totalSvg, totalRetailPending, totalProlinksPending, totalSvgPending
      };
    }

    function showDashboard() {
      uploadScreen.classList.add('hidden');
      dashboard.classList.remove('hidden');
      renderDashboard();
    }

    function renderDashboard() {
      document.getElementById('report-date-badge').textContent = `üìÖ ${appData.reportDate}`;
      renderSummaryCards();
      renderChampion();
      renderLeaderboard();
      renderTable();
      renderFooterStats();
    }

    function renderSummaryCards() {
      const stats = appData.teamStats;
      document.getElementById('summary-cards').innerHTML = `
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Employees</div>
          <div class="text-2xl font-bold">${stats.total}</div>
        </div>
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Working Days</div>
          <div class="text-2xl font-bold">${stats.currentDay}</div>
        </div>
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Team Output</div>
          <div class="text-2xl font-bold text-cyan-400">${stats.totalOutput.toLocaleString()}</div>
        </div>
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Avg Achievement</div>
          <div class="text-2xl font-bold">${stats.avgAchievement.toFixed(1)}%</div>
        </div>
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="text-xs uppercase tracking-wide text-emerald-400 mb-1">‚úÖ On Track</div>
          <div class="text-2xl font-bold text-emerald-400">${stats.onTrack}</div>
        </div>
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="text-xs uppercase tracking-wide text-red-400 mb-1">üî¥ Critical</div>
          <div class="text-2xl font-bold text-red-400">${stats.critical}</div>
        </div>
      `;
    }

    function renderChampion() {
      const champ = appData.champion;
      document.getElementById('champion-card').innerHTML = `
        <div class="flex items-center gap-2 mb-4">
          <span class="text-3xl">üèÜ</span>
          <div>
            <div class="text-xs uppercase tracking-wide text-gray-400">Champion of the Month</div>
            <div class="text-lg font-bold">${champ?.name || 'TBD'}</div>
          </div>
        </div>
        ${champ ? `
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <div class="text-gray-400">Total Output</div>
              <div class="font-bold text-lg">${champ.totalDone}</div>
            </div>
            <div>
              <div class="text-gray-400">Achievement</div>
              <div class="font-bold text-lg text-emerald-400">${champ.achievementPct.toFixed(1)}%</div>
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderLeaderboard() {
      const top5 = appData.leaderboard.slice(0, 5);
      const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'];
      document.getElementById('leaderboard-card').innerHTML = `
        <div class="flex items-center gap-2 mb-4">
          <span class="text-xl">üéñÔ∏è</span>
          <div class="font-semibold">Top 5 Performers</div>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-5 gap-2">
          ${top5.map((emp, i) => `
            <div class="flex items-center gap-2 p-2 rounded-lg bg-slate-800">
              <span class="text-lg">${medals[i]}</span>
              <div class="min-w-0">
                <div class="font-medium text-sm truncate">${emp.name}</div>
                <div class="text-xs text-gray-400">${emp.achievementPct.toFixed(0)}%</div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function getFilteredEmployees() {
      let filtered = appData.employees;

      if (searchTerm) {
        filtered = filtered.filter(e => e.fullName.toLowerCase().includes(searchTerm.toLowerCase()));
      }

      if (filterStatus === 'ontrack') {
        filtered = filtered.filter(e => e.achievementPct >= 100);
      } else if (filterStatus === 'atrisk') {
        filtered = filtered.filter(e => e.achievementPct >= 80 && e.achievementPct < 100);
      } else if (filterStatus === 'critical') {
        filtered = filtered.filter(e => e.achievementPct < 80);
      } else if (filterStatus === 'star') {
        filtered = filtered.filter(e => e.alerts.some(a => a.type === 'star'));
      }

      if (sortConfig.key) {
        filtered = [...filtered].sort((a, b) => {
          let aVal = a[sortConfig.key];
          let bVal = b[sortConfig.key];
          if (typeof aVal === 'string') { aVal = aVal.toLowerCase(); bVal = bVal.toLowerCase(); }
          if (aVal < bVal) return sortConfig.direction === 'asc' ? -1 : 1;
          if (aVal > bVal) return sortConfig.direction === 'asc' ? 1 : -1;
          return 0;
        });
      }

      return filtered;
    }

    function renderTable() {
      const employees = getFilteredEmployees();
      
      // Header
      document.getElementById('table-header').innerHTML = `
        <tr>
          <th class="px-4 py-3 text-left font-semibold border-b border-slate-700 cursor-pointer hover:bg-slate-700" onclick="handleSort('fullName')">
            Employee ${sortConfig.key === 'fullName' ? (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì') : ''}
          </th>
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700">Target</th>
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700">Trend</th>
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700">Alerts</th>
          ${Array.from({ length: appData.currentDay }, (_, i) => `
            <th class="px-1 py-3 text-center font-semibold border-b border-slate-700 text-xs min-w-[32px]">${i + 1}</th>
          `).join('')}
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700 cursor-pointer hover:bg-slate-700" onclick="handleSort('totalDone')">
            Total ${sortConfig.key === 'totalDone' ? (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì') : ''}
          </th>
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700">Target Req.</th>
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700 cursor-pointer hover:bg-slate-700" onclick="handleSort('shortfall')">
            Shortfall ${sortConfig.key === 'shortfall' ? (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì') : ''}
          </th>
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700 cursor-pointer hover:bg-slate-700" onclick="handleSort('achievementPct')">
            % ${sortConfig.key === 'achievementPct' ? (sortConfig.direction === 'asc' ? '‚Üë' : '‚Üì') : ''}
          </th>
          <th class="px-3 py-3 text-center font-semibold border-b border-slate-700">Pending</th>
        </tr>
      `;

      // Body
      document.getElementById('table-body').innerHTML = employees.map((emp, idx) => `
        <tr class="hover:bg-slate-800 ${idx % 2 === 0 ? '' : 'bg-slate-900/50'}">
          <td class="px-4 py-2 border-b border-slate-700">
            <div class="font-medium">${emp.name}</div>
            <div class="text-xs text-gray-500">${emp.id}</div>
          </td>
          <td class="px-3 py-2 text-center border-b border-slate-700 font-bold">${emp.dailyTarget}</td>
          <td class="px-3 py-2 text-center border-b border-slate-700">
            <span class="text-xl ${emp.trend === 'up' ? 'text-emerald-400' : emp.trend === 'down' ? 'text-red-400' : 'text-gray-400'}">
              ${emp.trend === 'up' ? '‚Üë' : emp.trend === 'down' ? '‚Üì' : '‚Üí'}
            </span>
          </td>
          <td class="px-3 py-2 text-center border-b border-slate-700">
            <div class="flex justify-center gap-1 flex-wrap">
              ${emp.alerts.map(a => `
                <span class="cursor-help" title="${a.message}">
                  ${a.type === 'critical' ? 'üî¥' : a.type === 'warning' ? '‚ö†Ô∏è' : a.type === 'inactive' ? 'üëª' : a.type === 'star' ? '‚≠ê' : 'üìà'}
                </span>
              `).join('')}
            </div>
          </td>
          ${emp.dailyData.slice(0, appData.currentDay).map(day => `
            <td class="px-1 py-2 text-center border-b border-slate-700" title="Day ${day.day}: R${day.retail} P${day.prolinks} S${day.svg}">
              <div class="w-7 h-7 mx-auto rounded flex items-center justify-center text-xs font-medium text-white ${getColorClass(day.total, emp.dailyTarget)}">
                ${day.total}
              </div>
            </td>
          `).join('')}
          <td class="px-3 py-2 text-center font-bold border-b border-slate-700 text-cyan-400">${emp.totalDone}</td>
          <td class="px-3 py-2 text-center border-b border-slate-700">${emp.targetRequired}</td>
          <td class="px-3 py-2 text-center font-bold border-b border-slate-700 ${emp.shortfall > 0 ? 'text-red-400' : 'text-emerald-400'}">
            ${emp.shortfall > 0 ? '-' + emp.shortfall : '0'}
          </td>
          <td class="px-3 py-2 text-center border-b border-slate-700">
            <div class="flex items-center justify-center gap-2">
              <div class="w-16 h-2 rounded-full bg-slate-700 overflow-hidden">
                <div class="h-full rounded-full ${emp.achievementPct >= 100 ? 'bg-emerald-500' : emp.achievementPct >= 80 ? 'bg-amber-500' : 'bg-red-500'}" style="width: ${Math.min(100, emp.achievementPct)}%"></div>
              </div>
              <span class="font-bold ${emp.achievementPct >= 100 ? 'text-emerald-400' : emp.achievementPct >= 80 ? 'text-amber-400' : 'text-red-400'}">
                ${emp.achievementPct.toFixed(0)}%
              </span>
            </div>
          </td>
          <td class="px-3 py-2 text-center border-b border-slate-700 text-gray-400">${emp.totalPending}</td>
        </tr>
      `).join('');
    }

    function getColorClass(total, target) {
      if (target === 10) {
        if (total >= 10) return 'cell-green';
        if (total >= 8) return 'cell-yellow';
        return 'cell-red';
      } else {
        if (total >= 8) return 'cell-green';
        if (total >= 6) return 'cell-yellow';
        return 'cell-red';
      }
    }

    function handleSort(key) {
      if (sortConfig.key === key) {
        sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
      } else {
        sortConfig.key = key;
        sortConfig.direction = 'asc';
      }
      renderTable();
    }

    function renderFooterStats() {
      const stats = appData.teamStats;
      const total = stats.totalRetail + stats.totalProlinks + stats.totalSvg;
      const employees = appData.employees;

      document.getElementById('footer-stats').innerHTML = `
        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="font-semibold mb-3">üìä Team Work Breakdown</div>
          <div class="space-y-3">
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Retail</span>
                <span>${stats.totalRetail} (${(stats.totalRetail/total*100).toFixed(1)}%)</span>
              </div>
              <div class="h-2 rounded-full bg-slate-700">
                <div class="h-full rounded-full bg-blue-500" style="width: ${stats.totalRetail/total*100}%"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Prolinks</span>
                <span>${stats.totalProlinks} (${(stats.totalProlinks/total*100).toFixed(1)}%)</span>
              </div>
              <div class="h-2 rounded-full bg-slate-700">
                <div class="h-full rounded-full bg-purple-500" style="width: ${stats.totalProlinks/total*100}%"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>SVG</span>
                <span>${stats.totalSvg} (${(stats.totalSvg/total*100).toFixed(1)}%)</span>
              </div>
              <div class="h-2 rounded-full bg-slate-700">
                <div class="h-full rounded-full bg-teal-500" style="width: ${stats.totalSvg/total*100}%"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="font-semibold mb-3">üìã Pending Work Summary</div>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-gray-400">Total Retail Pending</span>
              <span class="font-bold">${stats.totalRetailPending}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Total Prolinks Pending</span>
              <span class="font-bold">${stats.totalProlinksPending}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">Total SVG Pending</span>
              <span class="font-bold">${stats.totalSvgPending}</span>
            </div>
            <div class="pt-2 mt-2 border-t border-slate-700 flex justify-between">
              <span class="font-semibold">Total Backlog</span>
              <span class="font-bold text-amber-400">${stats.totalRetailPending + stats.totalProlinksPending + stats.totalSvgPending}</span>
            </div>
          </div>
        </div>

        <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
          <div class="font-semibold mb-3">üìà Performance Distribution</div>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-emerald-400">Exceeding (‚â•110%)</span>
              <span class="font-bold">${employees.filter(e => e.achievementPct >= 110).length}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-emerald-400">On Track (100-109%)</span>
              <span class="font-bold">${employees.filter(e => e.achievementPct >= 100 && e.achievementPct < 110).length}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-amber-400">At Risk (80-99%)</span>
              <span class="font-bold">${employees.filter(e => e.achievementPct >= 80 && e.achievementPct < 100).length}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-red-400">Critical (&lt;80%)</span>
              <span class="font-bold">${employees.filter(e => e.achievementPct < 80).length}</span>
            </div>
          </div>
        </div>
      `;
    }

    function toggleTheme() {
      darkMode = !darkMode;
      document.body.classList.toggle('light-mode');
      if (darkMode) {
        document.body.classList.remove('bg-gray-50', 'text-gray-900');
        document.body.classList.add('bg-slate-950', 'text-gray-100');
        document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
      } else {
        document.body.classList.remove('bg-slate-950', 'text-gray-100');
        document.body.classList.add('bg-gray-50', 'text-gray-900');
        document.getElementById('theme-toggle').textContent = 'üåô';
      }
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    function resetApp() {
      appData = null;
      searchTerm = '';
      filterStatus = 'all';
      sortConfig = { key: null, direction: 'asc' };
      searchInput.value = '';
      filterSelect.value = 'all';
      dashboard.classList.add('hidden');
      uploadScreen.classList.remove('hidden');
    }
  </script>
</body>
</html>
